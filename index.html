<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J&J Studio — Quitar Fondos Pro</title>
    <style>
        :root {
            --bg: #0b0d12; --panel: #10131a; --panel-2: #161b26; --text: #ecf1ff;
            --muted: #64748b; --border: #1a2030; --accent: #6e7cff; --vip: #00d2ff;
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* HEADER */
        header { padding: 15px 20px; background: rgba(16,19,26,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .logo { font-weight: 900; font-size: 1.2rem; color: var(--vip); letter-spacing: 1px; }
        #status-tag { font-size: 10px; padding: 4px 10px; border-radius: 20px; background: #1a2030; color: #64748b; font-weight: bold; }

        /* LAYOUT */
        main { display: grid; grid-template-columns: 360px 1fr; height: calc(100vh - 60px); }
        @media (max-width: 1000px) { main { grid-template-columns: 1fr; height: auto; } }

        /* CONTROLES */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        .group { background: var(--panel-2); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        h2 { font-size: 11px; color: var(--muted); text-transform: uppercase; margin-bottom: 12px; border-bottom: 1px solid #1a2030; padding-bottom: 5px; }

        .control-row { display: grid; grid-template-columns: 100px 1fr 35px; gap: 10px; align-items: center; margin-bottom: 10px; }
        label { font-size: 11px; color: #8899af; font-weight: 600; }
        .val-box { font-size: 10px; background: #0b0d12; padding: 3px; border-radius: 4px; text-align: center; color: var(--vip); }

        /* BOTONES */
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; margin-bottom: 10px; font-size: 12px; }
        .btn-vip { background: var(--vip); color: #000; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-nav { background: #1c2540; color: var(--vip); border: 1px solid var(--vip); }
        .btn-main { background: linear-gradient(135deg, var(--accent), #22d3ee); color: #fff; margin-top: 10px; }
        .btn-sec { background: #1a2030; color: #fff; border: 1px solid #2d3748; }

        input[type="range"] { -webkit-appearance: none; background: #1b2238; height: 4px; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--accent); border-radius: 50%; cursor: pointer; }

        /* AREA DE TRABAJO */
        .stage { background: #07080a; display: flex; align-items: center; justify-content: center; padding: 20px; overflow: hidden; }
        .canvas-container { position: relative; background-image: radial-gradient(#1a2030 1px, transparent 1px); background-size: 20px 20px; border-radius: 8px; border: 1px solid #1a2030; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        canvas { max-width: 100%; max-height: 80vh; display: block; }

        /* MODALES */
        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal { background: var(--panel); border: 1px solid var(--border); padding: 25px; border-radius: 15px; width: 400px; text-align: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <div class="logo">J&J STUDIO PRO</div>
        <div id="status-tag">MODO INVITADO</div>
    </header>

    <main>
        <aside class="sidebar">
            <button class="btn btn-nav" onclick="location.href='simulador.html'">✨ IR AL SIMULADOR MOCKUP</button>
            
            <div class="group">
                <h2>1. Cargar Archivo</h2>
                <input type="file" id="fileInp" accept="image/*" style="font-size:11px; color:#64748b;">
            </div>

            <div class="group">
                <h2>2. Configuración</h2>
                <div class="control-row">
                    <label>Modo</label>
                    <select id="mode" style="background:#0b0d12; color:#fff; border:1px solid #1a2030; padding:5px; border-radius:5px; grid-column: span 2;">
                        <option value="white">Quitar Blanco</option>
                        <option value="black">Quitar Negro</option>
                        <option value="auto">Automático</option>
                    </select>
                </div>
                <div class="control-row">
                    <label>Tolerancia</label>
                    <input type="range" id="tol" min="0" max="150" value="60">
                    <div class="val-box" id="vTol">60</div>
                </div>
                <div class="control-row">
                    <label>Suavizado</label>
                    <input type="range" id="soft" min="0" max="10" step="0.1" value="0.8">
                    <div class="val-box" id="vSoft">0.8</div>
                </div>
            </div>

            <div class="group">
                <h2>3. Herramientas</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <button class="btn btn-sec" onclick="location.reload()">Reiniciar</button>
                    <button class="btn btn-sec">Recortar</button>
                </div>
                <button class="btn btn-main" onclick="handleDownload()">DESCARGAR PNG</button>
            </div>
            
            <p style="font-size:10px; color:#444; text-align:center;">Urban Cartoon © 2026</p>
        </aside>

        <section class="stage">
            <div class="canvas-container">
                <canvas id="c"></canvas>
            </div>
        </section>
    </main>

    <div id="vipModal" class="modal-bg hidden">
        <div class="modal">
            <h3 style="color:var(--vip)">Acceso Restringido</h3>
            <p style="font-size:13px; color:var(--muted)">La descarga en alta resolución está disponible solo para socios de la Comunidad J&J.</p>
            <button class="btn btn-main" onclick="window.open('https://wa.me/51916689969?text=Hola,%20quiero%20activar%20mi%20membresía%20VIP','_blank')">Activar por WhatsApp</button>
            <button class="btn btn-sec" onclick="document.getElementById('vipModal').classList.add('hidden')">Cerrar</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
        let imgOrig = document.createElement('canvas'), oCtx = imgOrig.getContext('2d');
        let isVip = localStorage.getItem('jj_session') === 'active';

        if(isVip) {
            document.getElementById('status-tag').innerText = "SOCIO VIP ACTIVO";
            document.getElementById('status-tag').style.color = "#10b981";
        }

        document.getElementById('fileInp').onchange = e => {
            const img = new Image();
            img.onload = () => {
                imgOrig.width = img.width; imgOrig.height = img.height;
                oCtx.drawImage(img, 0, 0);
                process();
            };
            img.src = URL.createObjectURL(e.target.files[0]);
        };

        function process() {
            if(!imgOrig.width) return;
            const tol = parseInt(document.getElementById('tol').value);
            const soft = parseFloat(document.getElementById('soft').value);
            document.getElementById('vTol').innerText = tol;
            document.getElementById('vSoft').innerText = soft;

            const id = oCtx.getImageData(0,0,imgOrig.width,imgOrig.height), d = id.data;
            const out = ctx.createImageData(imgOrig.width,imgOrig.height), o = out.data;
            
            for(let i=0; i<d.length; i+=4) {
                const r=d[i], g=d[i+1], b=d[i+2], a=d[i+3];
                const brightness = (r+g+b)/3;
                let alpha = a;
                
                if (document.getElementById('mode').value === 'white') {
                    if (brightness > (255 - tol)) alpha = 0;
                } else if (document.getElementById('mode').value === 'black') {
                    if (brightness < tol) alpha = 0;
                }
                
                o[i]=r; o[i+1]=g; o[i+2]=b; o[i+3]=alpha;
            }
            canvas.width = imgOrig.width; canvas.height = imgOrig.height;
            ctx.putImageData(out, 0, 0);
        }

        function handleDownload() {
            if(!isVip) {
                document.getElementById('vipModal').classList.remove('hidden');
            } else {
                const link = document.createElement('a');
                link.download = 'jj_studio_result.png';
                link.href = canvas.toDataURL();
                link.click();
            }
        }

        ['tol', 'soft', 'mode'].forEach(id => document.getElementById(id).oninput = process);
    </script>
</body>
</html>
