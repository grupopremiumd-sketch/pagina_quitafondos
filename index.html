<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quitar Fondo - Comunidad J&J</title>
    <style>
        :root {
            --bg-dark: #121212;
            --panel-dark: #1e1e1e;
            --accent: #00e676;
            --text: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: var(--panel-dark);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Panel Lateral */
        .sidebar {
            width: 300px;
            background-color: var(--panel-dark);
            padding: 20px;
            border-right: 1px solid #333;
            overflow-y: auto;
        }

        /* Área de Trabajo */
        .workspace {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                linear-gradient(45deg, #222 25%, transparent 25%), 
                linear-gradient(-45deg, #222 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #222 75%), 
                linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            position: relative;
        }

        canvas {
            max-width: 90%;
            max-height: 90%;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* Controles */
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 0.9em; color: #aaa; }
        
        input[type="range"] { width: 100%; accent-color: var(--accent); }
        
        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-primary { background-color: var(--accent); color: #000; }
        .btn-outline { background-color: transparent; border: 1px solid #555; color: white; }
        button:hover { opacity: 0.8; }

        #drop-zone {
            border: 2px dashed #444;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold; font-size: 1.2em;">COMUNIDAD J&J <span style="color: var(--accent);">PRO</span></div>
    <div>Herramienta de Fondos (Beta)</div>
</header>

<div class="main-container">
    <div class="sidebar">
        <div id="drop-zone">
            Arrastra tu imagen aquí o haz clic
            <input type="file" id="fileInput" hidden accept="image/*">
        </div>

        <div class="control-group">
            <label>Tolerancia de color</label>
            <input type="range" id="tolerance" min="0" max="150" value="30">
        </div>

        <div class="control-group">
            <label>Color a eliminar</label>
            <input type="color" id="targetColor" value="#ffffff" style="width: 100%; height: 40px; border: none; background: none;">
        </div>

        <button class="btn-primary" onclick="processImage()">QUITAR FONDO</button>
        <button class="btn-outline" onclick="downloadImage()">DESCARGAR PNG</button>
        <button class="btn-outline" style="color: #ff5252;" onclick="resetImage()">REINICIAR</button>
    </div>

    <div class="workspace">
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('drop-zone');
    let originalImage = null;

    // Carga de imagen
    dropZone.onclick = () => fileInput.click();
    
    fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) loadImage(file);
    };

    function loadImage(file) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                originalImage = img;
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    function processImage() {
        if (!originalImage) return;

        // Resetear al original antes de procesar
        ctx.drawImage(originalImage, 0, 0);

        const tolerance = parseInt(document.getElementById('tolerance').value);
        const targetHex = document.getElementById('targetColor').value;
        const targetRGB = hexToRgb(targetHex);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i+1];
            const b = data[i+2];

            const distance = Math.sqrt(
                Math.pow(r - targetRGB.r, 2) +
                Math.pow(g - targetRGB.g, 2) +
                Math.pow(b - targetRGB.b, 2)
            );

            if (distance < tolerance) {
                data[i+3] = 0; // Transparencia
            }
        }
        ctx.putImageData(imageData, 0, 0);
    }

    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    function downloadImage() {
        const link = document.createElement('a');
        link.download = 'comunidad-jj-sin-fondo.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    }

    function resetImage() {
        if (originalImage) {
            ctx.drawImage(originalImage, 0, 0);
        }
    }

    // Soporte para Arrastrar y Soltar
    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = var(--accent); };
    dropZone.ondragleave = () => { dropZone.style.borderColor = "#444"; };
    dropZone.ondrop = (e) => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (file) loadImage(file);
    };
</script>

</body>
</html>

