<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quitar Fondo — J&J Studio Pro</title>
  <style>
    :root{
      --bg:#0a0a0a; --panel:#111; --text:#eeeeee; --muted:#9ca3af;
      --accent:#6366f1; --accent-2:#0ea5e9; --border:#1f1f1f;
      --success-1:#10b981; --success-2:#22c55e; --overlay:rgba(0,0,0,.55); --vip:#00d2ff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}
    header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;background:#0b0b0b;position:sticky;top:0;z-index:10}
    header h1{font-size:15px;margin:0;font-weight:900;letter-spacing:.5px;color:var(--vip)}
    .wrap{display:grid;grid-template-columns:350px 1fr;gap:16px;height:calc(100vh - 58px);padding:16px}
    @media(max-width:900px){.wrap{grid-template-columns:1fr; overflow-y:auto;}}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:15px;overflow-y:auto}
    .panel h2{font-size:13px;font-weight:700;margin:15px 0 8px;color:var(--muted);text-transform:uppercase}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;margin:10px 0}
    label{font-size:13px;color:#e5e7eb}
    input[type="color"], select, input[type="number"], button, input[type="file"]{background:#1a1a1a;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px}
    input[type="range"]{width:100%;accent-color:var(--vip)}
    .btn-nav{width:100%;background:#222;color:var(--vip);border:1px solid var(--vip);padding:10px;cursor:pointer;font-weight:800;margin-bottom:10px;border-radius:8px}
    .btn-download{background:linear-gradient(135deg,var(--success-1),var(--success-2));border:none;color:#052e1a;padding:12px;border-radius:8px;cursor:pointer;font-weight:900;width:100%;margin-top:15px}
    .canvasWrap{position:relative;background:#0b0b0b;border:1px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    canvas#canvas{display:block;transform-origin:top left}
    .cp-wrap{display:flex;gap:10px;margin-top:5px}
    #cpSV{border-radius:6px;border:1px solid #2a2a2a;cursor:crosshair}
    #cpH{border-radius:6px;border:1px solid #2a2a2a;cursor:ns-resize}
  </style>
</head>
<body>
  <header>
    <h1>J&J STUDIO PRO — QUITAFONDOS</h1>
  </header>
  <main class="wrap">
    <section class="panel">
      <button class="btn-nav" onclick="location.href='simulador.html'">✨ IR AL SIMULADOR</button>
      <div class="body">
        <h2>1. Cargar imagen</h2>
        <input id="file" type="file" accept="image/*">
        <h2>2. Configuración</h2>
        <div class="row">
          <label>Modo</label>
          <select id="mode">
            <option value="white">Quitar blanco</option>
            <option value="black">Quitar negro</option>
            <option value="pick">Elegir color</option>
          </select>
          <input id="color" type="color" value="#ffffff">
        </div>
        <div class="row"><label>Tolerancia</label><input id="fuzz" type="range" min="0" max="200" value="60"></div>
        <div class="row"><label>Suavizado</label><input id="feather" type="range" min="0" max="10" step="0.1" value="0.8"></div>
        
        <h2>3. Color del lienzo</h2>
        <div class="cp-wrap">
          <canvas id="cpSV" width="200" height="100"></canvas>
          <canvas id="cpH" width="20" height="100"></canvas>
        </div>
        <button id="reset" style="width:100%; margin-top:20px; background:transparent">Reiniciar Todo</button>
        <button id="download" class="btn-download">DESCARGAR PNG</button>
      </div>
    </section>
    <section class="canvasWrap" id="stage">
      <canvas id="canvas"></canvas>
    </section>
  </main>

  <script>
    (function(){
      const file=document.getElementById('file'), canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d');
      const mode=document.getElementById('mode'), color=document.getElementById('color'), fuzz=document.getElementById('fuzz');
      const stage=document.getElementById('stage');
      let ocanvas=document.createElement('canvas'), octx=ocanvas.getContext('2d'), scale=1, lastOut=null;

      file.onchange = e => {
        const f = e.target.files[0];
        const img = new Image();
        img.onload = () => {
          ocanvas.width=img.width; ocanvas.height=img.height;
          octx.drawImage(img,0,0);
          canvas.width=img.width; canvas.height=img.height;
          scale = Math.min(stage.clientWidth/img.width, stage.clientHeight/img.height, 0.8);
          process();
        };
        img.src = URL.createObjectURL(f);
      };

      function process(){
        if(!ocanvas.width) return;
        const target = hexToRgb(color.value);
        const threshold = (+fuzz.value) * 2.5;
        const src = octx.getImageData(0,0,ocanvas.width,ocanvas.height), d = src.data;
        const out = ctx.createImageData(ocanvas.width,ocanvas.height), o = out.data;
        for(let i=0; i<d.length; i+=4){
          const dist = Math.sqrt((d[i]-target[0])**2 + (d[i+1]-target[1])**2 + (d[i+2]-target[2])**2);
          o[i]=d[i]; o[i+1]=d[i+1]; o[i+2]=d[i+2];
          o[i+3] = dist < threshold ? 0 : d[i+3];
        }
        lastOut=out; render();
      }

      function render(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(lastOut) ctx.putImageData(lastOut,0,0);
        canvas.style.transform=`scale(${scale})`;
      }

      function hexToRgb(h){const v=h.replace('#',''); return [parseInt(v.slice(0,2),16),parseInt(v.slice(2,4),16),parseInt(v.slice(4,6),16)];}

      const cpH=document.getElementById('cpH');
      function drawH(){const g=cpH.getContext('2d'); const grd=g.createLinearGradient(0,0,0,100); for(let i=0;i<=360;i+=10) grd.addColorStop(i/360,`hsl(${i},100%,50%)`); g.fillStyle=grd; g.fillRect(0,0,20,100);}
      drawH();
      cpH.onmousedown = e => { const r=cpH.getBoundingClientRect(); stage.style.background=`hsl(${((e.clientY-r.top)/100)*360},50%,15%)`; };

      document.getElementById('download').onclick = () => {
        const a=document.createElement('a'); a.download='jj_studio.png'; a.href=canvas.toDataURL(); a.click();
      };

      [mode, color, fuzz].forEach(el => el.oninput = process);
      stage.onwheel = e => { e.preventDefault(); scale *= e.deltaY>0?0.9:1.1; render(); };
      document.getElementById('reset').onclick = () => location.reload();
    })();
  </script>
</body>
</html>
