<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quitar Fondos Pro - Comunidad J&J</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0a0a0a; --panel: #161616; --accent: #00ff88; --border: #2a2a2a; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 320px; background: var(--panel); border-right: 1px solid var(--border); overflow-y: auto; padding: 15px; box-sizing: border-box; }
        .vip-header { border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 15px; }
        .btn-vip { background: linear-gradient(90deg, #ffd700, #ffa500); border: none; width: 100%; padding: 12px; font-weight: bold; border-radius: 5px; cursor: pointer; margin-bottom: 8px; }
        .btn-ws { background: #25d366; color: white; text-decoration: none; display: block; text-align: center; padding: 10px; border-radius: 5px; font-size: 13px; }
        
        /* Controls */
        .section-title { font-size: 11px; color: #666; text-transform: uppercase; margin: 20px 0 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        .group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #aaa; margin-bottom: 8px; }
        input[type="range"] { width: 100%; accent-color: var(--accent); cursor: pointer; }
        select, input[type="number"] { width: 100%; background: #222; border: 1px solid var(--border); color: white; padding: 8px; border-radius: 4px; }
        
        .color-row { display: flex; gap: 10px; align-items: center; }
        #canvasColor { width: 40px; height: 40px; border: none; background: none; cursor: pointer; }

        /* Workspace */
        .workspace { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; background: #111; background-image: radial-gradient(#222 1px, transparent 1px); background-size: 20px 20px; }
        canvas { max-width: 90%; max-height: 90%; cursor: crosshair; box-shadow: 0 0 30px rgba(0,0,0,0.5); background-image: conic-gradient(#1a1a1a 90deg, #222 90deg 180deg, #1a1a1a 180deg 270deg, #222 270deg); background-size: 20px 20px; }
        
        .footer-tools { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; }
        .btn-main { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="vip-header">
        <button class="btn-vip" onclick="window.open('https://comunidadjj.com')">ACCESO VIP J&J</button>
        <button class="btn-ws" style="background:#444; margin-bottom: 8px;">1 PRUEBA GRATUITA</button>
        <a href="https://wa.me/51900000000?text=Hola%20quiero%20info%20VIP" class="btn-ws"><i class="fab fa-whatsapp"></i> SOPORTE WHATSAPP</a>
    </div>

    <button class="btn-ws" style="background:#333;" onclick="document.getElementById('fileInput').click()">CARGAR IMAGEN</button>
    <input type="file" id="fileInput" hidden accept="image/*">

    <div class="section-title">Eliminar Fondo</div>
    <div class="group">
        <label>Modo</label>
        <select id="mode">
            <option value="color">Elegir color (Clic en imagen)</option>
            <option value="white">Quitar blanco</option>
            <option value="black">Quitar negro</option>
        </select>
    </div>

    <div class="group">
        <label>Tolerancia: <span id="v-tol">30</span></label>
        <input type="range" id="tolerance" min="0" max="150" value="30">
    </div>
    
    <div class="group">
        <label>Suavizado (px): <span id="v-smooth">1</span></label>
        <input type="range" id="smooth" min="0" max="10" value="1">
    </div>

    <div class="group">
        <label>Color del lienzo / seleccionado</label>
        <div class="color-row">
            <input type="color" id="targetColor" value="#ffffff">
            <span id="hexText">#FFFFFF</span>
        </div>
    </div>

    <div class="section-title">Redimensionar</div>
    <div class="group" style="display: flex; gap: 10px;">
        <div><label>Ancho</label><input type="number" id="w_px"></div>
        <div><label>Alto</label><input type="number" id="h_px"></div>
    </div>
    <div class="group">
        <label><input type="checkbox" id="aspect" checked> Mantener proporción</label>
    </div>

    <div class="group">
        <label>Unidades / Resolución</label>
        <div style="display: flex; gap: 5px;">
            <select id="units"><option>px</option><option>in</option><option>cm</option></select>
            <input type="number" id="res" value="300">
        </div>
    </div>

    <div class="group">
        <label>Método</label>
        <select id="method">
            <option>Alta calidad (Bicúbica)</option>
            <option>Bueno (Bilinear)</option>
            <option>Rápido (Nearest)</option>
        </select>
    </div>
</div>

<div class="workspace">
    <canvas id="mainCanvas"></canvas>
    <div class="footer-tools">
        <button class="btn-main" onclick="download()">DESCARGAR PNG</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let originalImg = null;
    let ratio = 1;

    // Carga de imagen
    document.getElementById('fileInput').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (event) => {
            originalImg = new Image();
            originalImg.onload = () => {
                canvas.width = originalImg.width;
                canvas.height = originalImg.height;
                ratio = originalImg.width / originalImg.height;
                document.getElementById('w_px').value = originalImg.width;
                document.getElementById('h_px').value = originalImg.height;
                render();
            };
            originalImg.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // Proporción Automática
    document.getElementById('w_px').oninput = (e) => {
        if(document.getElementById('aspect').checked) {
            document.getElementById('h_px').value = Math.round(e.target.value / ratio);
        }
    };

    // Cuentagotas (Clic en canvas)
    canvas.onclick = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        const pixel = ctx.getImageData(x, y, 1, 1).data;
        const hex = "#" + ((1 << 24) + (pixel[0] << 16) + (pixel[1] << 8) + pixel[2]).toString(16).slice(1);
        document.getElementById('targetColor').value = hex;
        document.getElementById('hexText').innerText = hex.toUpperCase();
        render();
    };

    // Actualizar valores de sliders
    ['tolerance', 'smooth'].forEach(id => {
        document.getElementById(id).oninput = () => {
            document.getElementById('v-' + id).innerText = document.getElementById(id).value;
            render();
        }
    });

    function render() {
        if (!originalImg) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(originalImg, 0, 0);

        const tol = parseInt(document.getElementById('tolerance').value);
        const targetHex = document.getElementById('targetColor').value;
        const rT = parseInt(targetHex.slice(1,3), 16);
        const gT = parseInt(targetHex.slice(3,5), 16);
        const bT = parseInt(targetHex.slice(5,7), 16);

        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;

        for (let i = 0; i < data.length; i += 4) {
            const r = data[i], g = data[i+1], b = data[i+2];
            const dist = Math.sqrt((r-rT)**2 + (g-gT)**2 + (b-bT)**2);
            if (dist < tol) data[i+3] = 0;
        }
        ctx.putImageData(imgData, 0, 0);
    }

    function download() {
        const link = document.createElement('a');
        link.download = 'comunidad-jj-premium.png';
        link.href = canvas.toDataURL();
        link.click();
    }
</script>
</body>
</html>
