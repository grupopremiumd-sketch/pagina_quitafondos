<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J&J Simulador Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --bg: #050505; --panel: #111; --text: #eee; --vip: #00d2ff; --border: #262626; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
        .app { display: grid; grid-template-columns: 280px 1fr; height: 100vh; }
        aside { background: var(--panel); border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        main { display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a1a 1px, transparent 1px); background-size: 25px 25px; position: relative; }
        .container { position: relative; width: 90%; max-width: 500px; aspect-ratio: 1/1; }
        canvas { width: 100%; height: 100%; border-radius: 8px; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-vip { background: var(--vip); color: #000; }
        .btn-nav { background: #222; color: #fff; font-size: 11px; }
        input[type="range"] { width: 100%; accent-color: var(--vip); margin: 10px 0; }
        #qr-box { position: absolute; z-index: 100; cursor: move; display: none; padding: 5px; background: #fff; top: 20px; right: 20px; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #333; cursor: pointer; display: inline-block; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="app">
        <aside>
            <h2 style="color:var(--vip); text-align:center;">J&J STUDIO</h2>
            <button class="btn btn-nav" onclick="location.href='index.html'">← VOLVER AL INICIO</button>
            <hr style="border:0; border-top:1px solid #222; margin:20px 0;">
            
            <p style="font-size:11px; color:#888;">1. CARGAR DISEÑO PNG</p>
            <input type="file" id="loader" accept="image/*" hidden>
            <button class="btn btn-vip" onclick="document.getElementById('loader').click()">SUBIR ARCHIVO</button>

            <div style="margin-top:20px;">
                <p style="font-size:11px; color:#888;">2. AJUSTAR TAMAÑO</p>
                <input type="range" id="size" min="0.1" max="1.5" step="0.01" value="0.5">
                <p style="font-size:11px; color:#888;">3. POSICIÓN VERTICAL</p>
                <input type="range" id="posY" min="-250" max="250" value="0">
            </div>

            <div style="margin-top:20px;">
                <p style="font-size:11px; color:#888;">4. COLOR PRENDA</p>
                <div class="color-dot" style="background:#fff;" onclick="change('white')"></div>
                <div class="color-dot" style="background:#111;" onclick="change('black')"></div>
                <div class="color-dot" style="background:#777;" onclick="change('gray')"></div>
            </div>

            <hr style="border:0; border-top:1px solid #222; margin:20px 0;">
            <input type="text" id="qrInp" placeholder="WhatsApp Link" style="width:100%; padding:8px; background:#000; color:#fff; border:1px solid #333; border-radius:5px;">
            <button class="btn" style="background:#222; color:#fff;" onclick="genQR()">AÑADIR QR</button>
        </aside>

        <main>
            <div class="container" id="dropzone">
                <canvas id="cv"></canvas>
                <div id="qr-box"></div>
            </div>
            <button class="btn" style="position:fixed; bottom:20px; right:20px; width:auto; padding:15px 30px; background:#fff; color:#000;" onclick="down()">DESCARGAR</button>
        </main>
    </div>

    <script>
        const cv = document.getElementById('cv'), ctx = cv.getContext('2d');
        let mock = new Image(), user = new Image(), mode = 'white';

        const imgMap = {
            white: 'https://raw.githubusercontent.com/tdonofrio/mockup-assets/main/white_front.png',
            black: 'https://raw.githubusercontent.com/tdonofrio/mockup-assets/main/black_front.png',
            gray: 'https://raw.githubusercontent.com/tdonofrio/mockup-assets/main/gray_front.png'
        };

        function change(c) {
            mode = c;
            mock.src = imgMap[c];
        }

        document.getElementById('loader').onchange = e => {
            const reader = new FileReader();
            reader.onload = f => { user.src = f.target.result; user.onload = draw; };
            reader.readAsDataURL(e.target.files[0]);
        };

        mock.onload = draw;
        mock.crossOrigin = "anonymous";
        change('white'); // Carga inicial

        function draw() {
            cv.width = 1000; cv.height = 1000;
            ctx.clearRect(0, 0, 1000, 1000);
            if (mock.complete) ctx.drawImage(mock, 0, 0, 1000, 1000);
            if (user.src) {
                const s = document.getElementById('size').value;
                const y = parseInt(document.getElementById('posY').value);
                const w = user.width * s, h = user.height * s;
                ctx.save();
                ctx.globalAlpha = 0.9;
                if(mode !== 'black') ctx.globalCompositeOperation = 'multiply';
                ctx.drawImage(user, (1000-w)/2, (1000-h)/2 + y, w, h);
                ctx.restore();
            }
        }

        document.getElementById('size').oninput = draw;
        document.getElementById('posY').oninput = draw;

        function genQR() {
            const v = document.getElementById('qrInp').value;
            if(!v) return;
            const b = document.getElementById('qr-box');
            b.innerHTML = ""; b.style.display = "block";
            new QRCode(b, { text: v, width: 80, height: 80 });
        }

        let drag = false;
        const qb = document.getElementById('qr-box');
        qb.onmousedown = () => drag = true;
        window.onmousemove = e => {
            if(drag) {
                const r = document.getElementById('dropzone').getBoundingClientRect();
                qb.style.left = (e.clientX - r.left - 40) + 'px';
                qb.style.top = (e.clientY - r.top - 40) + 'px';
            }
        };
        window.onmouseup = () => drag = false;

        function down() {
            const link = document.createElement('a');
            link.download = 'jj_mockup.png';
            link.href = cv.toDataURL();
            link.click();
        }
    </script>
</body>
</html>

</html>
