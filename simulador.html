<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>J&J Studio Pro — Simulador Camiseta 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --bg:#0a0a0a; --panel:#111; --text:#eee; --vip:#00d2ff; }
        body { margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); overflow:hidden; }
        .wrap { display:grid; grid-template-columns:350px 1fr; height:100vh; }
        .panel { padding:20px; background:var(--panel); border-right:1px solid #222; overflow-y:auto; z-index:10; }
        .stage { background:radial-gradient(circle, #222 0%, #000 100%); position:relative; }
        h2 { font-size:11px; color:#666; text-transform:uppercase; border-bottom:1px solid #333; padding-bottom:5px; margin:20px 0 10px; }
        .control-group { background:#161616; padding:15px; border-radius:12px; border:1px solid #222; margin-bottom:10px; }
        label { font-size:11px; color:#888; display:block; margin-bottom:5px; }
        input[type="range"] { width:100%; accent-color:var(--vip); }
        .btn-dl { width:100%; padding:15px; background:linear-gradient(135deg,#10b981,#22c55e); border:none; border-radius:8px; color:#052e1a; font-weight:900; cursor:pointer; margin-top:10px; }
        #login-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:1000; display:none; align-items:center; justify-content:center; text-align:center; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div style="background:#111; padding:40px; border-radius:20px; border:1px solid #333;">
            <h2 style="color:var(--vip)">LÍMITE DE PRUEBA ALCANZADO</h2>
            <p>Suscríbete a Comunidad J&J para usar el simulador 3D.</p>
            <button class="btn-dl" onclick="window.open('https://wa.me/51916689969')">ACTIVAR VIP</button>
        </div>
    </div>

    <main class="wrap">
        <aside class="panel">
            <button style="width:100%; padding:10px; background:#1c2540; color:var(--vip); border:1px solid var(--vip); border-radius:8px; cursor:pointer;" onclick="location.href='index.html'">← VOLVER AL QUITAFONDOS</button>
            
            <h2>1. Tu Diseño (PNG)</h2>
            <div class="control-group">
                <input type="file" id="design-file" accept="image/*">
            </div>

            <h2>2. Ajustes de Prenda</h2>
            <div class="control-group">
                <label>Color de Camiseta</label>
                <input type="color" id="shirt-color" value="#ffffff" style="width:100%; height:35px; border:none; background:none;">
                <label style="margin-top:10px;">Tamaño del Estampado</label>
                <input type="range" id="logo-scale" min="0.5" max="4" step="0.1" value="1.5">
                <label style="margin-top:10px;">Posición Vertical</label>
                <input type="range" id="logo-pos" min="-1" max="1" step="0.05" value="0">
            </div>

            <h2>3. Movimiento</h2>
            <div class="control-group">
                <label>Giro Automático</label>
                <input type="range" id="speed-range" min="0" max="0.03" step="0.001" value="0.01">
            </div>

            <button class="btn-dl" onclick="handleDownload()">DESCARGAR MOCKUP 3D</button>
        </aside>

        <section class="stage" id="container-3d"></section>
    </main>

<script>
    let scene, camera, renderer, shirt, designTexture;
    let downloadsUsed = localStorage.getItem('jj_3d_done') || 0;

    function init() {
        const container = document.getElementById('container-3d');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // Iluminación Pro
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const light = new THREE.DirectionalLight(0xffffff, 0.5);
        light.position.set(2, 2, 5);
        scene.add(light);

        // CREAR FORMA DE CAMISETA (Usando una silueta real)
        const shape = new THREE.Shape();
        // Dibujamos el contorno de una T-Shirt simplificada
        shape.moveTo(-1.5, 2);
        shape.lineTo(1.5, 2);   // Hombros
        shape.lineTo(2.5, 1.2); // Manga Der
        shape.lineTo(1.8, 0.5); // Axila Der
        shape.lineTo(1.8, -2);  // Cintura Der
        shape.lineTo(-1.8, -2); // Cintura Izq
        shape.lineTo(-1.8, 0.5);// Axila Izq
        shape.lineTo(-2.5, 1.2);// Manga Izq
        shape.lineTo(-1.5, 2);  // Hombro Izq

        const geometry = new THREE.ExtrudeGeometry(shape, { depth: 0.2, bevelEnabled: true, bevelThickness: 0.1 });
        const material = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.8 });
        
        shirt = new THREE.Group();
        const mesh = new THREE.Mesh(geometry, material);
        mesh.rotation.x = Math.PI; // Corregir orientación
        shirt.add(mesh);
        scene.add(shirt);

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        shirt.rotation.y += parseFloat(document.getElementById('speed-range').value);
        renderer.render(scene, camera);
    }

    document.getElementById('design-file').onchange = e => {
        const file = e.target.files[0];
        const loader = new THREE.TextureLoader();
        loader.load(URL.createObjectURL(file), (tex) => {
            designTexture = tex;
            updateTexture();
        });
    };

    function updateTexture() {
        if(!designTexture) return;
        const scale = document.getElementById('logo-scale').value;
        const posY = document.getElementById('logo-pos').value;
        
        designTexture.repeat.set(scale, scale);
        designTexture.offset.set(0.5 - scale/2, (0.5 - scale/2) + parseFloat(posY));
        
        // Aplicamos el diseño solo a la parte frontal
        shirt.children[0].material = new THREE.MeshStandardMaterial({
            color: document.getElementById('shirt-color').value,
            map: designTexture,
            roughness: 0.6
        });
    }

    document.getElementById('shirt-color').oninput = (e) => {
        shirt.children[0].material.color.set(e.target.value);
    };

    document.getElementById('logo-scale').oninput = updateTexture;
    document.getElementById('logo-pos').oninput = updateTexture;

    function handleDownload() {
        if(downloadsUsed >= 1) {
            document.getElementById('login-overlay').style.display = 'flex';
        } else {
            const link = document.createElement('a');
            link.download = 'jj_mockup_3d.png';
            link.href = renderer.domElement.toDataURL();
            link.click();
            downloadsUsed++;
            localStorage.setItem('jj_3d_done', 1);
        }
    }

    init();
</script>
</body>
</html>
