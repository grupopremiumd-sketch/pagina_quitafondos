<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J&J STUDIO - MOCKUP PRO</title>
  <style>
    :root { --bg:#0b0d12; --panel:#10131a; --text:#ecf1ff; --accent:#6e7cff; --vip:#00d2ff; }
    body { margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); display:flex; flex-direction:column; height:100vh; }
    header { padding:15px; border-bottom:1px solid #1a2030; display:flex; justify-content:space-between; align-items:center; }
    main { display:grid; grid-template-columns: 1fr 350px; flex:1; overflow:hidden; }
    .stage { background:#0d1117; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
    #canvasContainer { position:relative; width:500px; height:500px; }
    canvas { width:100%; height:100%; display:block; z-index:1; }
    #userLogo { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:150px; cursor:move; z-index:10; pointer-events:auto; mix-blend-mode:multiply; }
    .controls { background:var(--panel); padding:20px; border-left:1px solid #1a2030; overflow-y:auto; }
    .group { background:#0f1219; border:1px solid #1a2030; border-radius:12px; padding:15px; margin-bottom:15px; }
    label { font-size:11px; color:#aab3d1; text-transform:uppercase; font-weight:700; display:block; margin-bottom:8px; }
    input, button, select { width:100%; padding:10px; border-radius:8px; border:1px solid #1a2030; background:#10131a; color:#fff; cursor:pointer; margin-bottom:10px; }
    .btn-vip { background:linear-gradient(135deg,#6e7cff,#22d3ee); border:none; font-weight:800; }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:900; color:var(--vip)">J&J STUDIO PRO</div>
    <button onclick="location.href='index.html'" style="width:auto; font-size:10px;">VOLVER</button>
  </header>
  <main>
    <section class="stage">
      <div id="canvasContainer">
        <canvas id="c"></canvas>
        <img id="userLogo" src="" style="display:none" draggable="false">
      </div>
    </section>
    <aside class="controls">
      <div class="group">
        <label>1. Subir tu Logo</label>
        <input type="file" id="fileInp" accept="image/*">
        <label>Opacidad</label>
        <input type="range" id="logoAlpha" min="0" max="100" value="90">
      </div>
      <div class="group">
        <label>2. Color Camiseta</label>
        <input type="color" id="tColor" value="#ffffff">
      </div>
      <div class="group">
        <label>3. Vista</label>
        <select id="tView">
          <option value="front">Frente</option>
          <option value="back">Espalda</option>
        </select>
      </div>
      <button class="btn-vip" id="btnDl">DESCARGAR MOCKUP</button>
    </aside>
  </main>

  <script>
    const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
    const userLogo = document.getElementById('userLogo');
    let baseImg = new Image();

    const ASSETS = {
      front: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793740/1.BOXYFITDELANTERO_BASE_WHITE_1_oad518.png",
      back: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793939/1._BOXYFITESPALDA_WHITE_yav9mn.png"
    };

    function loadBase(view) {
      baseImg = new Image();
      baseImg.crossOrigin = "anonymous";
      baseImg.src = ASSETS[view];
      baseImg.onload = render;
      baseImg.onerror = () => alert("Error cargando imagen base. Revisa tu internet.");
    }

    function render() {
      canvas.width = 1000; canvas.height = 1000;
      ctx.clearRect(0,0,1000,1000);
      
      // 1. Color
      ctx.fillStyle = document.getElementById('tColor').value;
      ctx.fillRect(0,0,1000,1000);

      // 2. MÃ¡scara de camiseta
      ctx.globalCompositeOperation = "destination-in";
      ctx.drawImage(baseImg, 0, 0, 1000, 1000);
      ctx.globalCompositeOperation = "source-over";
    }

    document.getElementById('fileInp').onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = ev => {
        userLogo.src = ev.target.result;
        userLogo.style.display = "block";
      };
      reader.readAsDataURL(file);
    };

    // Mover Logo (Drag and Drop)
    let isDrag = false;
    userLogo.onmousedown = () => isDrag = true;
    window.onmousemove = e => {
      if(!isDrag) return;
      const rect = document.getElementById('canvasContainer').getBoundingClientRect();
      userLogo.style.left = (e.clientX - rect.left) + 'px';
      userLogo.style.top = (e.clientY - rect.top) + 'px';
    };
    window.onmouseup = () => isDrag = false;

    // Escala con Rueda
    document.getElementById('canvasContainer').onwheel = e => {
      e.preventDefault();
      let scale = userLogo.offsetWidth;
      if(e.deltaY < 0) scale += 10; else scale -= 10;
      userLogo.style.width = scale + "px";
    };

    document.getElementById('tColor').oninput = render;
    document.getElementById('tView').onchange = e => loadBase(e.target.value);
    document.getElementById('logoAlpha').oninput = e => userLogo.style.opacity = e.target.value/100;

    loadBase('front');
  </script>
</body>
</html>