<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N√≥madas Style ‚Äî J&J Studio Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --bg: #000; --panel: #0a0a0a; --accent: #00d2ff; --border: #1a1a1a;
            --text-muted: #666; --vip: #00d2ff; --wa: #25d366;
        }
        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg); color: white; font-family: -apple-system, system-ui, sans-serif; overflow: hidden; }
        
        .layout { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        
        /* Sidebar Estilo N√≥madas */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); padding: 25px; display: flex; flex-direction: column; gap: 20px; z-index: 100; overflow-y: auto; }
        .logo { font-weight: 900; font-size: 22px; letter-spacing: -1.5px; color: #fff; margin-bottom: 20px; }
        .logo span { color: var(--vip); }

        .control-group { background: #111; border: 1px solid var(--border); padding: 16px; border-radius: 14px; }
        .label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; display: block; font-weight: 700; }
        
        input[type="range"] { width: 100%; accent-color: #fff; cursor: pointer; height: 4px; }
        input[type="file"] { font-size: 11px; color: #444; }
        
        .btn-premium { background: #fff; color: #000; border: none; padding: 15px; border-radius: 10px; font-weight: 800; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-premium:hover { transform: scale(1.02); background: var(--vip); }
        
        /* Visor 3D */
        .viewer { position: relative; background: radial-gradient(circle at center, #151515 0%, #000 100%); cursor: grab; }
        #canvas-3d { width: 100%; height: 100%; }

        /* Paywall Bloqueo */
        #paywall { position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .pay-card { background: #111; border: 1px solid #222; padding: 40px; border-radius: 24px; max-width: 400px; }
    </style>
</head>
<body>

<div id="paywall">
    <div class="pay-card">
        <h2 style="font-size: 30px; margin-bottom: 10px;">üíé J&J VIP</h2>
        <p style="color: #666; margin-bottom: 30px;">Prueba gratuita agotada. Suscr√≠bete para crear mockups ilimitados con tu modelo 3D real.</p>
        <button class="btn-premium" style="margin-bottom: 10px;" onclick="window.open('https://wa.me/51916689969')">ACTIVAR POR WHATSAPP</button>
        <button onclick="location.reload()" style="background:none; border:none; color:#444; cursor:pointer; font-size:12px;">Ya soy socio / Volver</button>
    </div>
</div>

<div class="layout">
    <aside class="sidebar">
        <div class="logo">J&J <span>STUDIO</span></div>
        <button onclick="location.href='index.html'" style="background:none; border:1px solid #333; color:#888; padding:8px; border-radius:8px; cursor:pointer; font-size:11px; margin-bottom:10px;">‚Üê IR AL QUITAFONDOS</button>

        <div class="control-group">
            <span class="label">1. Tu Dise√±o (PNG)</span>
            <input type="file" id="upload-png" accept="image/png">
        </div>

        <div class="control-group">
            <span class="label">2. Color de Prenda</span>
            <input type="color" id="shirt-color" value="#ffffff" style="width:100%; height:35px; border:none; background:none; cursor:pointer;">
        </div>

        <div class="control-group">
            <span class="label">3. Ajustes de Estampado</span>
            <label style="font-size:10px; color:#444;">Tama√±o</label>
            <input type="range" id="logo-scale" min="0.1" max="2" step="0.01" value="0.5">
            <label style="font-size:10px; color:#444; margin-top:10px; display:block;">Posici√≥n</label>
            <input type="range" id="logo-y" min="-1" max="1" step="0.01" value="0.3">
        </div>

        <div class="control-group">
            <span class="label">4. Animaci√≥n</span>
            <input type="range" id="anim-speed" min="0" max="0.03" step="0.001" value="0.005">
        </div>

        <button class="btn-premium" onclick="handleDownload()">DESCARGAR MOCKUP 3D</button>
    </aside>

    <main class="viewer" id="container-3d"></main>
</div>

<script>
    let scene, camera, renderer, shirt, designTexture, controls;
    let downloadsUsed = localStorage.getItem('jj_sim_used') || 0;

    function init() {
        scene = new THREE.Scene();
        const container = document.getElementById('container-3d');
        
        camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 0, 3.5);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        container.appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Luces de Estudio
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const light = new THREE.DirectionalLight(0xffffff, 0.5);
        light.position.set(2, 5, 5);
        scene.add(light);

        // CARGA TU MODELO tshirt.glb
        const loader = new THREE.GLTFLoader();
        loader.load('tshirt.glb', (gltf) => {
            shirt = gltf.scene;
            shirt.position.y = -1; // Ajuste de altura inicial
            scene.add(shirt);
        }, undefined, (error) => {
            console.error("Error cargando el modelo:", error);
            alert("Sube el archivo tshirt.glb a tu GitHub para verlo.");
        });

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if (shirt) {
            shirt.rotation.y += parseFloat(document.getElementById('anim-speed').value);
        }
        controls.update();
        renderer.render(scene, camera);
    }

    // L√≥gica para el Dise√±o PNG
    document.getElementById('upload-png').onchange = e => {
        const file = e.target.files[0];
        const loader = new THREE.TextureLoader();
        loader.load(URL.createObjectURL(file), (tex) => {
            designTexture = tex;
            tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
            updateShirt();
        });
    };

    function updateShirt() {
        if (!shirt) return;
        const color = document.getElementById('shirt-color').value;
        const scale = document.getElementById('logo-scale').value;
        const posY = document.getElementById('logo-y').value;

        shirt.traverse((child) => {
            if (child.isMesh) {
                child.material.color.set(color);
                if (designTexture) {
                    child.material.map = designTexture;
                    child.material.map.repeat.set(scale, scale);
                    child.material.map.offset.set(0.5 - scale/2, parseFloat(posY));
                }
                child.material.needsUpdate = true;
            }
        });
    }

    document.getElementById('shirt-color').oninput = updateShirt;
    document.getElementById('logo-scale').oninput = updateShirt;
    document.getElementById('logo-y').oninput = updateShirt;

    // Descarga y Bloqueo
    function handleDownload() {
        if (downloadsUsed >= 1) {
            document.getElementById('paywall').style.display = 'flex';
        } else {
            const link = document.createElement('a');
            link.download = 'jj-mockup-pro.png';
            link.href = renderer.domElement.toDataURL('image/png');
            link.click();
            downloadsUsed++;
            localStorage.setItem('jj_sim_used', 1);
            setTimeout(() => { document.getElementById('paywall').style.display = 'flex'; }, 1000);
        }
    }

    window.addEventListener('resize', () => {
        const container = document.getElementById('container-3d');
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });

    init();
</script>
</body>
</html>
