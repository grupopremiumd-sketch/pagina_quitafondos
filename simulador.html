<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J&J Studio — T-Shirt Mockup PRO</title>
  <style>
    /* ===== Tokens J&J STUDIO ===== */
    :root{
      --bg:#f8fafc; --panel:#ffffff; --panel-2:#ffffff; --text:#0b1220;
      --muted:#64748b; --border:#e5e7eb; --accent:#2563eb; --accent-2:#22c1ee;
      --ring:#94b0ff; --shadow:0 10px 30px rgba(0,0,0,.06); --radius:14px;
      --vip: #00d2ff;
    }
    body.theme-dark{
      --bg:#0b0d12; --panel:#10131a; --panel-2:#0f1219; --text:#ecf1ff;
      --muted:#aab3d1; --border:#1a2030; --accent:#6e7cff; --accent-2:#22d3ee;
      --ring:#7c8bff; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; font-family: ui-sans-serif, system-ui, sans-serif; background: var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; }
    
    header{ position:sticky; top:0; z-index:5; backdrop-filter:blur(10px); background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.75)); border-bottom:1px solid var(--border); }
    body.theme-dark header{ background: linear-gradient(180deg, rgba(16,19,26,.85), rgba(16,19,26,.55)); }
    .container{ max-width:1400px; margin:0 auto; padding:14px 16px; display:flex; align-items:center; gap:12px; }
    .logo-dot{width:10px;height:10px;border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent-2)); }
    h1{margin:0;font-size:18px;letter-spacing:.4px;font-weight:700}
    .badge{margin-left:auto; font-size:11px; padding:4px 8px; border-radius:999px; background:#eef2ff; border:1px solid #c7d2fe; color:#334155; font-weight:600;}
    body.theme-dark .badge{background:rgba(124,139,255,.14); border:1px solid #2b3560; color:#cfd6ff}
    
    main{ max-width:1400px; margin:24px auto; padding:0 16px; display:grid; gap:20px; grid-template-columns:1.6fr .9fr; align-items:start; }
    @media (max-width:1080px){ main{grid-template-columns:1fr} }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); }
    .stage{ padding:16px; display:grid; gap:12px; }
    .canvas-wrap{ position:relative; border:1px solid var(--border); border-radius:12px; padding:12px; background:var(--panel-2); min-height:72vh; }
    .stage-frame{ position:relative; width:100%; aspect-ratio: 1 / 1; overflow:hidden; background:#eef2ff; border-radius:10px; isolation:isolate; }
    body.theme-dark .stage-frame{ background:#0d1117; }
    canvas{ position:absolute; left:50%; top:50%; transform: translate(-50%, -50%); width:100%; height:auto; display:block; border-radius:10px; }
    
    #artWrap{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); pointer-events:none; }
    #imgArt{ max-width:40%; transform-origin:center center; pointer-events:auto; user-select:none; display:none; }

    .controls{ padding:16px; display:grid; gap:12px; }
    .group{ background:var(--panel-2); border:1px solid var(--border); border-radius:12px; padding:12px; display:grid; gap:10px; }
    .row{display:grid; grid-template-columns:140px 1fr; gap:12px; align-items:center}
    label{opacity:.85;font-size:12px; letter-spacing:.3px}
    
    select, button, input[type="color"], input[type="file"]{ height:40px; border-radius:10px; padding:0 12px; color:var(--text); background:var(--panel); border:1px solid var(--border); outline:none; transition: .2s; }
    .toggle{ display:flex; background:#f1f5f9; border:1px solid var(--border); border-radius:10px; padding:2px; gap:2px; height:40px; }
    body.theme-dark .toggle{ background:#0c111b; border-color:#1c2540; }
    .pill{ flex:1; display:grid; place-items:center; font-size:13px; cursor:pointer; border-radius:8px; color:#334155 }
    body.theme-dark .toggle .pill{ color:#c8d0ff }
    .pill.active{ color:#fff; font-weight:700; background: linear-gradient(135deg, var(--accent), var(--accent-2)); }
    
    .btn{ width:100%; background: linear-gradient(135deg, var(--accent), var(--accent-2)); border:none; color:#fff; font-weight:800; height:44px; border-radius:12px; cursor:pointer; }
    .btn.secondary{ background:transparent; color:var(--text); border:1px solid var(--border); }
    .btn-nav{ background:#1c2540; color:var(--vip); border:1px solid var(--vip); font-size: 11px; height: 32px; margin-bottom: 10px; padding: 0 15px; width: auto; }
  </style>
</head>
<body class="theme-dark">
  <header>
    <div class="container">
      <div class="logo-dot"></div>
      <div>
        <h1>J&J STUDIO MOCKUP</h1>
        <div style="font-size:10px; opacity:0.6">BY COMUNIDAD J&J</div>
      </div>
      <div class="badge" id="vip-status">INVITADO</div>
    </div>
  </header>

  <main>
    <section class="card stage">
      <div class="canvas-wrap">
        <div class="stage-frame" id="stage">
          <canvas id="c" width="2048" height="2048"></canvas>
          <div id="artWrap">
            <img id="imgArt" alt="diseño" draggable="false">
          </div>
        </div>
      </div>
      <div style="font-size:11px; opacity:0.6">Arrastra el diseño para moverlo. Rueda del ratón para escalar.</div>
    </section>

    <aside class="controls">
      <button class="btn-nav" onclick="location.href='index.html'">← VOLVER A QUITAR FONDOS</button>
      
      <div class="card">
        <div class="group">
          <div class="row">
            <label>Tema</label>
            <select id="themeSel">
              <option value="light">Claro</option>
              <option value="dark" selected>Oscuro</option>
            </select>
          </div>
          <div class="row">
            <label>Vista</label>
            <div class="toggle" id="viewToggle">
              <div class="pill active" data-val="front">Frontal</div>
              <div class="pill" data-val="back">Espalda</div>
            </div>
          </div>
        </div>

        <div class="group">
          <div class="row">
            <label>Color Camiseta</label>
            <input id="color" type="color" value="#ffffff" />
          </div>
          <div class="row">
            <label>Textura</label>
            <select id="texType">
              <option value="none">Lisa</option>
              <option value="acid">Acid Wash</option>
              <option value="full">Full Print</option>
            </select>
          </div>
        </div>

        <div class="group">
          <label>Subir Arte (PNG)</label>
          <input type="file" id="inpFile" accept="image/*">
          <div class="row" style="margin-top:10px">
            <label>Opacidad Arte</label>
            <input id="artAlpha" type="range" min="0" max="100" value="100" />
          </div>
        </div>

        <div class="group">
          <button id="savePNG" class="btn">DESCARGAR MOCKUP VIP</button>
        </div>
      </div>
    </aside>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // --- LÓGICA DE MEMBRESÍA J&J ---
    let isVip = localStorage.getItem('jj_session') === 'active';
    if(isVip) {
      document.getElementById('vip-status').innerText = "SOCIO VIP ACTIVO";
      document.getElementById('vip-status').style.color = "#00d2ff";
      document.getElementById('vip-status').style.borderColor = "#00d2ff";
    }

    const C = document.getElementById('c'), ctx = C.getContext('2d');
    const imgArt = document.getElementById('imgArt');
    const inpFile = document.getElementById('inpFile');
    const colorInp = document.getElementById('color');
    const texType = document.getElementById('texType');
    const themeSel = document.getElementById('themeSel');
    const artAlpha = document.getElementById('artAlpha');

    const ASSETS = {
      front: {
        base: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793740/1.BOXYFITDELANTERO_BASE_WHITE_1_oad518.png",
        lights: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793738/3.LUCESDELANTERAS_1_onw0b8.png",
        shadows: ["https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793743/4._SOMBRASDELANTERAS_1_mmw5n2.png"],
        textures: {
          acid: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793861/ACID_WASH_DELANTERO_MOOD_TSHIRT_omnbjl.png",
          full: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793865/FULL_PRINT_TEXTURA_DELANTERO_MOD_yjx7qn.png"
        }
      },
      back: {
        base: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793939/1._BOXYFITESPALDA_WHITE_yav9mn.png",
        shadows: ["https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793937/2._SOMBRA_ESPALDA_1_nrxsoe.png", "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762793938/3._SOMBRA_ESPALDA_2_ljeabv.png"],
        textures: {
          acid: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762794027/ACID_WASH_ESPALDA_TSHIRT_s11l8a.png",
          full: "https://res.cloudinary.com/dzrlrxe2j/image/upload/v1762794025/FULL_PRINT_TEXTURA_ESPALDA_ljjzuo.png"
        }
      }
    };

    let currentSide = 'front';
    const cache = { front:{}, back:{} };

    async function load(src){
      if(!src) return null;
      const img = new Image(); img.crossOrigin="anonymous"; img.src = src;
      await new Promise(r => img.onload = r);
      return img;
    }

    async function render(){
      const a = ASSETS[currentSide];
      if(!cache[currentSide].base) cache[currentSide].base = await load(a.base);
      if(!cache[currentSide].shadows) cache[currentSide].shadows = await Promise.all(a.shadows.map(load));
      if(a.lights && !cache[currentSide].lights) cache[currentSide].lights = await load(a.lights);
      
      const tex = texType.value;
      if(tex !== 'none' && !cache[currentSide][tex]) cache[currentSide][tex] = await load(a.textures[tex]);

      ctx.clearRect(0,0,C.width,C.height);
      const base = cache[currentSide].base;
      const scale = Math.min(C.width/base.width, C.height/base.height);
      const w = base.width*scale, h = base.height*scale;
      const x = (C.width-w)/2, y = (C.height-h)/2;

      ctx.globalCompositeOperation = "source-over";
      ctx.fillStyle = colorInp.value;
      ctx.fillRect(x,y,w,h);
      ctx.globalCompositeOperation = "destination-in";
      ctx.drawImage(base, x, y, w, h);

      if(tex !== 'none'){
        ctx.globalCompositeOperation = "multiply";
        ctx.drawImage(cache[currentSide][tex], x, y, w, h);
      }

      ctx.globalCompositeOperation = "multiply";
      cache[currentSide].shadows.forEach(s => ctx.drawImage(s, x, y, w, h));

      if(currentSide === 'front' && cache.front.lights && tex !== 'acid'){
        ctx.globalCompositeOperation = "screen";
        ctx.drawImage(cache.front.lights, x, y, w, h);
      }
    }

    // --- Arte Drag/Scale ---
    let artPos = {x:0, y:0, s:1}, dragging = false;
    inpFile.onchange = e => {
      const r = new FileReader();
      r.onload = ev => { imgArt.src = ev.target.result; imgArt.style.display='block'; artPos={x:0,y:0,s:1}; updateArt(); };
      r.readAsDataURL(e.target.files[0]);
    };
    imgArt.onpointerdown = e => { dragging = true; imgArt.setPointerCapture(e.pointerId); };
    window.onpointermove = e => { if(dragging){ artPos.x += e.movementX; artPos.y += e.movementY; updateArt(); }};
    window.onpointerup = () => dragging = false;
    document.getElementById('stage').onwheel = e => {
      e.preventDefault();
      artPos.s = Math.max(0.1, artPos.s + (e.deltaY < 0 ? 0.05 : -0.05));
      updateArt();
    };
    function updateArt(){
      imgArt.style.transform = `translate(${artPos.x}px, ${artPos.y}px) scale(${artPos.s})`;
      imgArt.style.opacity = artAlpha.value / 100;
    }

    document.getElementById('viewToggle').onclick = e => {
      const pill = e.target.closest('.pill'); if(!pill) return;
      document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
      pill.classList.add('active');
      currentSide = pill.dataset.val;
      render();
    };

    themeSel.onchange = () => document.body.className = themeSel.value === 'dark' ? 'theme-dark' : '';

    document.getElementById('savePNG').onclick = () => {
      if(!isVip) {
        alert("Esta función requiere membresía VIP de Comunidad J&J.");
        return window.open("https://wa.me/51916689969?text=Hola,%20quiero%20activar%20mi%20suscripción", "_blank");
      }
      html2canvas(document.getElementById('stage'), { backgroundColor:null, scale:2 }).then(canvas => {
        const a = document.createElement('a'); a.download = `jj-mockup.png`;
        a.href = canvas.toDataURL(); a.click();
      });
    };

    colorInp.oninput = render;
    texType.onchange = render;
    artAlpha.oninput = updateArt;
    render();
  </script>
</body>
</html>